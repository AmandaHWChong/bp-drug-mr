---
title: "Genotype data preparation for input into GENESIS package"
output: html_document
date: "20-02-2023"
---

#Extract sample IDs 


## Use QCTOOLS to include only extracted sample IDs from genotype file

#Load necessarry packages 
module load apps/qctool/2.2.0

#Directory paths - Please edit directory paths to relevant input files 
export bgen_dir=/mnt/storage/private/mrcieu/data/ukbiobank/genetic/variants/arrays/imputed/released/2018-09-18/data/raw_downloaded/bgen #Directory to genotype data
export sample_dir=/mnt/storage/private/mrcieu/data/ukbiobank/genetic/variants/arrays/imputed/released/2018-09-18/data/id_mapping #Directory to sample data 
export dat_dir=/projects/MRC-IEU/research/projects/ieu2/p4/080/working/data/GWAS/UKB/GENESIS #Directory to file with ancestry specific sample IDs 
export out_dir=/projects/MRC-IEU/research/projects/ieu2/p4/080/working/data/GWAS/UKB/Genetic/dosage_bgen #Output directory 

for i in {1..22}
do
echo $i

qctool_v2.2.0 \
-s $sample_dir/data.chr1-22.sample \
-g $bgen_dir/ukb_imp_chr${i}_v3.bgen \
-og $out_dir/ukb_imp_chr${i}_v3_EAS.bgen \
-os $out_dir/ukb_imp_EAS.sample \
-incl-samples $data_dir/sample_ID_keep_EAS.txt \
-snp-stats

done

## Filter genotype file by frequecy (>0.01) and INFO score (>0.8)

## Convert bgen file to PLINK format (expect ~6-8 millions SNPs) 
